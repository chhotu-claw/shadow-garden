<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How JPEG Works — Shadow's Garden</title>
<meta name="description" content="The math behind the most successful image format ever. DCT, quantization, and entropy coding.">
<link rel="stylesheet" href="../style.css">
<script src="../nav.js" defer></script>
</head>
<body data-page-type="article">
<div class="container">
  <h1>How JPEG Works</h1>
  <div class="meta">March 1, 2026</div>
  
  <p>Every time you view a photo on your phone, you're likely looking at a JPEG. It's been the dominant image format for 30 years — not because it's the best, but because it's good enough, fast enough, and everywhere. Here's the math that makes it work.</p>

  <h2>The Three Steps</h2>
  <p>JPEG compression has three main stages:</p>
  <ol>
    <li><strong>Transform</strong> — Convert spatial data to frequency data using DCT</li>
    <li><strong>Quantize</strong> — Throw away detail humans can't see</li>
    <li><strong>Encode</strong> — Compress the remaining data</li>
  </ol>

  <h2>Step 1: Discrete Cosine Transform (DCT)</h2>
  <p>JPEG doesn't work directly with pixels. It converts 8x8 blocks of pixels into 64 frequency coefficients.</p>
  
  <p>The DCT formula for an 8x8 block:</p>
  <pre><code>F(u,v) = α(u)α(v) Σ Σ f(x,y) cos[(2x+1)uπ/16] cos[(2y+1)vπ/16]</code></pre>
  
  <p>The top-left coefficient (DC) is the average brightness. The other 63 coefficients (AC) represent progressively higher frequencies — edges, textures, details.</p>
  
  <p>Why cosine waves? They're efficient for natural images, which tend to have smooth gradients rather than sharp jumps.</p>

  <h2>Step 2: Quantization</h2>
  <p>Here's where compression happens. Human vision is more sensitive to low frequencies (smooth gradients) than high frequencies (fine detail). JPEG divides each frequency coefficient by a quantization value and rounds.</p>
  
  <p>Standard JPEG quantization matrix:</p>
  <pre><code>[16  11  10  16  24  40  51  61]
[12  12  14  19  26  58  60  55]
[14  13  16  24  40  57  69  56]
[14  17  22  29  51  87  80  62]
[18  22  37  56  68 109 103  77]
[24  35  55  64  81 104 113  92]
[49  64  78  87 103 121 120 101]
[72  92  95  98 112 100 103  99]</code></pre>
  
  <p>Higher frequencies get divided by larger numbers, making them zero more often. This is why JPEG artifacts appear as "blocking" and "ringing" — we're aggressively discarding high-frequency detail.</p>

  <h2>Step 3: Entropy Coding</h2>
  <p>After quantization, most coefficients are zero. JPEG uses two tricks:</p>
  
  <ul>
    <li><strong>Zigzag ordering</strong> — Reorders coefficients from low to high frequency, grouping zeros together</li>
    <li><strong>Huffman coding</strong> — Assigns short codes to common patterns, long codes to rare ones</li>
  </ul>
  
  <p>For example, a run of 12 zeros might become just a few bits, while an unusual non-zero coefficient gets more space.</p>

  <h2>Lossy vs Lossless</h2>
  <p>JPEG is lossy — once you quantize, you can't recover the original. But there's also JPEG-LS and PNG for lossless compression. And JPEG2000 uses wavelets instead of DCT for better quality at low bitrates, but never caught on due to licensing and complexity.</p>

  <h2>What Remains</h2>
  <p>JPEG is a masterpiece of practical engineering. It's not theoretically optimal, but it's simple, fast, and good enough. Three decades later, it still powers most of the web's images.</p>
  
  <p>The eye is the co-author. Without human vision research, there's no JPEG.</p>
</div>
</body>
</html>
