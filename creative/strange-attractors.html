<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strange Attractors — Shadow's Garden</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { 
    background: #050508; 
    color: #888; 
    font-family: 'JetBrains Mono', 'SF Mono', monospace;
    overflow: hidden;
    height: 100vh;
  }
  canvas { display: block; }
  #controls {
    position: fixed;
    bottom: 20px;
    left: 20px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    max-width: calc(100vw - 40px);
    z-index: 10;
  }
  button {
    background: #111;
    border: 1px solid #333;
    color: #666;
    padding: 8px 14px;
    font-family: inherit;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  button:hover { border-color: #555; color: #aaa; }
  button.active { background: #1a1a1a; border-color: #4a9; color: #4a9; }
  #info {
    position: fixed;
    top: 20px;
    left: 20px;
    font-size: 10px;
    color: #333;
    text-transform: uppercase;
    letter-spacing: 2px;
  }
  #equation {
    position: fixed;
    top: 20px;
    right: 20px;
    font-size: 10px;
    color: #222;
    text-align: right;
    font-family: 'Times New Roman', serif;
    font-style: italic;
    max-width: 200px;
  }
</style>
<link rel="stylesheet" href="../style.css">
<script src="../nav.js" defer></script>
<meta name="description" content="Interactive strange attractor visualizer — Lorenz, Rossler, and more. Chaotic systems that trace beautiful, never-repeating curves in 3D space.">
</head>
<body data-page-type="app">
<div id="info">strange attractors</div>
<div id="equation"></div>
<canvas id="c"></canvas>
<div id="controls">
  <button class="active" data-type="lorenz">Lorenz</button>
  <button data-type="rossler">Rössler</button>
  <button data-type="halvorsen">Halvorsen</button>
  <button data-type="thomas">Thomas</button>
  <button data-type="aizawa">Aizawa</button>
  <button data-type="dadras">Dadras</button>
</div>

<script>
const c = document.getElementById('c');
const ctx = c.getContext('2d');
const eq = document.getElementById('equation');
let w, h;

function resize() {
  w = c.width = window.innerWidth;
  h = c.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

const attractors = {
  lorenz: {
    name: 'Lorenz',
    eq: 'dx/dt = σ(y-x)<br>dy/dt = x(ρ-z)-y<br>dz/dt = xy-βz',
    params: { σ: 10, ρ: 28, β: 8/3 },
    scale: 12,
    speed: 0.008,
    init: () => ({ x: 0.1, y: 0, z: 0 })
  },
  rossler: {
    name: 'Rössler',
    eq: 'dx/dt = -y-z<br>dy/dt = x+ay<br>dz/dt = b+z(x-c)',
    params: { a: 0.2, b: 0.2, c: 5.7 },
    scale: 25,
    speed: 0.015,
    init: () => ({ x: 0.1, y: 0.1, z: 0.1 })
  },
  halvorsen: {
    name: 'Halvorsen',
    eq: 'dx/dt = -ax-4y-4z<br>dy/dt = -ay-4z-4x<br>dz/dt = -az-4x-4y',
    params: { a: 1.4 },
    scale: 40,
    speed: 0.006,
    init: () => ({ x: -5, y: 0, z: 0 })
  },
  thomas: {
    name: 'Thomas',
    eq: "dx/dt = sin(y)-bx<br>dy/dt = sin(z)-by<br>dz/dt = sin(x)-bz",
    params: { b: 0.208186 },
    scale: 60,
    speed: 0.02,
    init: () => ({ x: 1.1, y: 1.1, z: -0.01 })
  },
  aizawa: {
    name: 'Aizawa',
    eq: 'dx/dt = (z-b)x-dy<br>dy/dt = dx+(z-b)y<br>dz/dt = c+az-z³/3-(x²+y²)(1+ez)+fzg',
    params: { a: 0.95, b: 0.7, c: 0.6, d: 3.5, e: 0.25, f: 0.1 },
    scale: 80,
    speed: 0.012,
    init: () => ({ x: 0.1, y: 0, z: 0 })
  },
  dadras: {
    name: 'Dadras',
    eq: 'dx/dt = y-ax+byz<br>dy/dt = cy-dy+xz<br>dz/dt = hz+xy',
    params: { a: 3, b: 2.7, c: 1.7, d: 2, h: 9 },
    scale: 35,
    speed: 0.008,
    init: () => ({ x: 1.1, y: 2.1, z: -2.0 })
  }
};

let current = 'lorenz';
let points = [];
let frame = 0;

function project(x, y, z) {
  const scale = attractors[current].scale;
  const projScale = 200;
  const depth = 200;
  const cz = z + depth;
  const f = projScale / cz;
  return {
    x: w/2 + x * scale * f,
    y: h/2 + y * scale * f * 0.7,
    f
  };
}

function evolve(p, dt) {
  const a = attractors[current];
  let { x, y, z } = p;
  
  switch(current) {
    case 'lorenz': {
      const { σ, ρ, β } = a.params;
      const dx = σ * (y - x) * dt;
      const dy = (x * (ρ - z) - y) * dt;
      const dz = (x * y - β * z) * dt;
      return { x: x+dx, y: y+dy, z: z+dz };
    }
    case 'rossler': {
      const { a, b, c } = a.params;
      const dx = (-y - z) * dt;
      const dy = (x + a * y) * dt;
      const dz = (b + z * (x - c)) * dt;
      return { x: x+dx, y: y+dy, z: z+dz };
    }
    case 'halvorsen': {
      const { a } = a.params;
      const dx = (-a*x - 4*y - 4*z) * dt;
      const dy = (-a*y - 4*z - 4*x) * dt;
      const dz = (-a*z - 4*x - 4*y) * dt;
      return { x: x+dx, y: y+dy, z: z+dz };
    }
    case 'thomas': {
      const { b } = a.params;
      const dx = (Math.sin(y) - b*x) * dt;
      const dy = (Math.sin(z) - b*y) * dt;
      const dz = (Math.sin(x) - b*z) * dt;
      return { x: x+dx, y: y+dy, z: z+dz };
    }
    case 'aizawa': {
      const { a, b, c, d, e, f } = a.params;
      const dx = ((z - b) * x - d * y) * dt;
      const dy = (d * x + (z - b) * y) * dt;
      const dz = (c + a * z - Math.pow(z,3)/3 - (x*x + y*y)*(1 + e*z) + f*x*z) * dt;
      return { x: x+dx, y: y+dy, z: z+dz };
    }
    case 'dadras': {
      const { a, b, c, d, h } = a.params;
      const dx = (y - a*x + b*y*z) * dt;
      const dy = (c*y - d*y + x*z) * dt;
      const dz = (h*z + x*y) * dt;
      return { x: x+dx, y: y+dy, z: z+dz };
    }
  }
}

function reset() {
  points = [];
  const init = attractors[current].init();
  const numPoints = 800;
  for(let i = 0; i < numPoints; i++) {
    let p = { ...init };
    // Run ahead to fill the attractor
    for(let j = 0; j < 200; j++) {
      p = evolve(p, attractors[current].speed);
    }
    points.push(p);
  }
  eq.innerHTML = attractors[current].eq;
}

let prevPoints = points.map(p => project(p.x, p.y, p.z));

function draw() {
  ctx.fillStyle = 'rgba(5, 5, 8, 0.08)';
  ctx.fillRect(0, 0, w, h);
  
  const dt = attractors[current].speed;
  const hue = (frame * 0.1) % 360;
  
  for(let i = 0; i < points.length; i++) {
    points[i] = evolve(points[i], dt);
    const proj = project(points[i].x, points[i].y, points[i].z);
    const prev = prevPoints[i];
    
    const alpha = Math.min(1, proj.f * 1.5);
    ctx.strokeStyle = `hsla(${hue + i * 0.3}, 70%, 55%, ${alpha * 0.6})`;
    ctx.lineWidth = Math.max(0.5, proj.f * 2);
    
    ctx.beginPath();
    ctx.moveTo(prev.x, prev.y);
    ctx.lineTo(proj.x, proj.y);
    ctx.stroke();
    
    prevPoints[i] = proj;
  }
  
 requestAnimationFrame(function() { draw(); frame++; });
  request);
}

document.querySelectorAll('button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    current = btn.dataset.type;
    reset();
  });
});

reset();
draw();
</script>
</body>
</html>
