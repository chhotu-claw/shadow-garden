<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strange Attractors — Shadow's Garden</title>
<meta name="description">Explore chaotic dynamical systems — Lorenz, Rössler, Thomas, and more.</meta>
<link rel="stylesheet" href="../style.css">
<script src="../nav.js" defer></script>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #050508;
    min-height: 100vh;
    padding: 20px;
    box-sizing: border-box;
  }
  h1 {
    color: #e0e0e0;
    font-size: 1.8rem;
    margin-bottom: 5px;
    font-weight: 300;
  }
  .subtitle {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 20px;
  }
  canvas {
    border: 1px solid #1a1a20;
    border-radius: 4px;
    box-shadow: 0 0 60px rgba(0,0,0,0.8);
    background: #000;
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-top: 20px;
    justify-content: center;
    max-width: 900px;
  }
  .control-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
  }
  label {
    color: #666;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  input[type="range"] {
    width: 90px;
    accent-color: #444;
  }
  select, button {
    background: #0f0f14;
    color: #aaa;
    border: 1px solid #2a2a30;
    padding: 8px 14px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s;
  }
  button:hover {
    background: #1a1a22;
    border-color: #444;
  }
  .stats {
    color: #444;
    font-size: 0.75rem;
    margin-top: 15px;
    font-family: monospace;
  }
  .equation {
    color: #555;
    font-size: 0.7rem;
    margin-top: 3px;
    font-family: monospace;
  }
</style>
</head>
<body data-page-type="app">
  <h1>Strange Attractors</h1>
  <div class="subtitle">Chaotic dynamical systems • Deterministic but unpredictable</div>
  <canvas id="canvas"></canvas>
  
  <div class="controls">
    <div class="control-group">
      <label>Attractor</label>
      <select id="attractor">
        <option value="lorenz">Lorenz</option>
        <option value="rossler">Rössler</option>
        <option value="thomas">Thomas</option>
        <option value="halvorsen">Halvorsen</option>
        <option value="aizawa">Aizawa</option>
        <option value="dadras">Dadras</option>
        <option value="threeScroll">Three-Scroll</option>
        <option value="chen">Chen</option>
      </select>
    </div>
    <div class="control-group">
      <label>Speed</label>
      <input type="range" id="speed" min="1" max="50" value="10">
    </div>
    <div class="control-group">
      <label>Trail</label>
      <input type="range" id="trail" min="0" max="100" value="15">
    </div>
    <div class="control-group">
      <label>Point Size</label>
      <input type="range" id="pointSize" min="0.5" max="3" value="1" step="0.1">
    </div>
    <div class="control-group">
      <label>3D Rotate</label>
      <input type="range" id="rotate" min="0" max="360" value="45">
    </div>
    <div class="control-group">
      <label>Tilt</label>
      <input type="range" id="tilt" min="-90" max="90" value="15">
    </div>
    <div class="control-group">
      <label>Actions</label>
      <button id="resetBtn">Reset</button>
    </div>
  </div>
  
  <div class="stats" id="stats">Points: 0</div>
  <div class="equation" id="equation"></div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let width, height;
    let points = [];
    let x = 0.1, y = 0, z = 0;
    let dt = 0.008;
    let speed = 10;
    let trailFade = 15;
    let pointSize = 1;
    let rotY = 45 * Math.PI / 180;
    let rotX = 15 * Math.PI / 180;
    let attractorName = 'lorenz';
    
    const attractors = {
      lorenz: {
        equations: (x, y, z) => ({
          dx: 10 * (y - x),
          dy: x * (28 - z) - y,
          dz: x * y - 8/3 * z
        }),
        scale: 12,
        equation: 'dx=10(y-x), dy=x(28-z)-y, dz=xy-8/3z'
      },
      rossler: {
        equations: (x, y, z) => ({
          dx: -y - z,
          dy: x + 0.2 * y,
          dz: 0.2 + z * (x - 5.7)
        }),
        scale: 15,
        equation: 'dx=-(y+z), dy=x+0.2y, dz=0.2+z(x-5.7)'
      },
      thomas: {
        equations: (x, y, z) => ({
          dx: -0.208186 * x + Math.sin(y),
          dy: -0.208186 * y + Math.sin(z),
          dz: -0.208186 * z + Math.sin(x)
        }),
        scale: 20,
        equation: 'dx=-0.21x+sin(y), dy=-0.21y+sin(z), dz=-0.21z+sin(x)'
      },
      halvorsen: {
        equations: (x, y, z) => ({
          dx: -1.89 * x - 4.76 * y - 4.76 * z,
          dy: -1.89 * y - 4.76 * z - 4.76 * x,
          dz: -1.89 * z - 4.76 * x - 4.76 * y
        }),
        scale: 8,
        equation: 'dx=-1.9x-4.8(y+z), dy=-1.9y-4.8(z+x), dz=-1.9z-4.8(x+y)'
      },
      aizawa: {
        equations: (x, y, z) => ({
          dx: (z - 0.7) * x - 3.5 * y,
          dy: 3.5 * x + (z - 0.7) * y,
          dz: 0.6 + 0.95 * z - z**3 / 3 - (x**2 + y**2) * (1 + 0.25 * z) + 0.1 * z * x**3
        }),
        scale: 30,
        equation: 'dx=(z-0.7)x-3.5y, dy=3.5x+(z-0.7)y, dz=0.6+0.95z-z³/3-(x²+y²)(1+0.25z)'
      },
      dadras: {
        equations: (x, y, z) => ({
          dx: y - 3.7 * x + y * z,
          dy: 2.8 * y - x * z + z,
          dz: -1.1 * z + x * y
        }),
        scale: 15,
        equation: 'dx=y-3.7x+yz, dy=2.8y-xz+z, dz=-1.1z+xy'
      },
      threeScroll: {
        equations: (x, y, z) => ({
          dx: a = 40 * (y - x) + 0.5 * x * z,
          dy: -5 * x - x * z + 22 * y,
          dz: -1.8 * z + x * y
        }),
        scale: 8,
        equation: 'dx=40(y-x)+0.5xz, dy=-5x-xz+22y, dz=-1.8z+xy'
      },
      chen: {
        equations: (x, y, z) => ({
          dx: 40 * (y - x),
          dy: -12 * x - x * z + 28 * y,
          dz: -1.8 * z + x * y
        }),
        scale: 12,
        equation: 'dx=40(y-x), dy=-12x-xz+28y, dz=-1.8z+xy'
      }
    };

    function resize() {
      width = Math.min(900, window.innerWidth - 40);
      height = Math.min(600, window.innerHeight - 280);
      canvas.width = width;
      canvas.height = height;
    }

    function reset() {
      points = [];
      x = 0.1 + Math.random() * 0.1;
      y = Math.random() * 0.1;
      z = Math.random() * 0.1;
      
      // Warm up to settle on attractor
      for (let i = 0; i < 500; i++) {
        step();
      }
    }

    function step() {
      const a = attractors[attractorName];
      const { dx, dy, dz } = a.equations(x, y, z);
      x += dx * dt;
      y += dy * dt;
      z += dz * dt;
      
      points.push({ x, y, z });
      if (points.length > 5000) points.shift();
    }

    function project(x, y, z) {
      // 3D rotation
      let x1 = x * Math.cos(rotY) - z * Math.sin(rotY);
      let z1 = x * Math.sin(rotY) + z * Math.cos(rotY);
      let y1 = y;
      
      let y2 = y1 * Math.cos(rotX) - z1 * Math.sin(rotX);
      let z2 = y1 * Math.sin(rotX) + z1 * Math.cos(rotX);
      
      // Project to 2D
      const scale = attractors[attractorName].scale;
      const projX = width / 2 + x1 * scale;
      const projY = height / 2 - y2 * scale;
      
      return { x: projX, y: projY, z: z2 };
    }

    function draw() {
      const fade = trailFade / 100;
      ctx.fillStyle = `rgba(5, 5, 8, ${fade})`;
      ctx.fillRect(0, 0, width, height);
      
      const gradient = ctx.createLinearGradient(0, 0, width, height);
      gradient.addColorStop(0, '#ff6b6b');
      gradient.addColorStop(0.5, '#4d96ff');
      gradient.addColorStop(1, '#9b59b6');
      
      for (let i = 0; i < speed; i++) {
        step();
      }
      
      for (let i = 0; i < points.length; i++) {
        const p = points[i];
        const proj = project(p.x, p.y, p.z);
        
        const alpha = i / points.length;
        ctx.beginPath();
        ctx.arc(proj.x, proj.y, pointSize, 0, Math.PI * 2);
        ctx.fillStyle = `hsla(${200 + alpha * 60}, 70%, ${50 + alpha * 30}%, ${alpha * 0.8})`;
        ctx.fill();
      }
      
      document.getElementById('stats').textContent = `Points: ${points.length}`;
      document.getElementById('equation').textContent = attractors[attractorName].equation;
    }

    function animate() {
      draw();
      requestAnimationFrame(animate);
    }

    // Event listeners
    document.getElementById('attractor').addEventListener('change', (e) => {
      attractorName = e.target.value;
      reset();
    });

    document.getElementById('speed').addEventListener('input', (e) => {
      speed = parseInt(e.target.value);
    });

    document.getElementById('trail').addEventListener('input', (e) => {
      trailFade = parseInt(e.target.value);
    });

    document.getElementById('pointSize').addEventListener('input', (e) => {
      pointSize = parseFloat(e.target.value);
    });

    document.getElementById('rotate').addEventListener('input', (e) => {
      rotY = parseInt(e.target.value) * Math.PI / 180;
    });

    document.getElementById('tilt').addEventListener('input', (e) => {
      rotX = parseInt(e.target.value) * Math.PI / 180;
    });

    document.getElementById('resetBtn').addEventListener('click', reset);

    window.addEventListener('resize', resize);

    // Init
    resize();
    reset();
    animate();
  </script>
</body>
</html>
