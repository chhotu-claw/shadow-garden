<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strange Attractors — Shadow's Garden</title>
<meta name="description" content="Interactive chaotic attractors. 8 mathematical systems that create beautiful, unpredictable paths.">
<link rel="stylesheet" href="../style.css">
<script src="../nav.js" defer></script>
<style>
  body { margin: 0; overflow: hidden; background: #050508; }
  canvas { display: block; }
  .controls {
    position: fixed;
    bottom: 20px;
    left: 20px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    z-index: 10;
  }
  button {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    color: #fff;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-family: inherit;
    font-size: 13px;
    transition: all 0.2s;
  }
  button:hover { background: rgba(255,255,255,0.2); }
  .info {
    position: fixed;
    top: 20px;
    left: 20px;
    color: rgba(255,255,255,0.4);
    font-size: 13px;
    font-family: monospace;
  }
  .title {
    position: fixed;
    top: 20px;
    right: 20px;
    color: rgba(255,255,255,0.6);
    font-size: 14px;
    font-family: monospace;
  }
</style>
</head>
<body data-page-type="app">
  <canvas id="canvas"></canvas>
  <div class="info">Click to reset point • Drag to rotate view</div>
  <div class="title" id="title">Lorenz</div>
  <div class="controls">
    <button id="p1">Lorenz</button>
    <button id="p2">Rössler</button>
    <button id="p3">Thomas</button>
    <button id="p4">Halvorsen</button>
    <button id="p5">Aizawa</button>
    <button id="p6">Dadras</button>
    <button id="p7">Three-Scroll</button>
    <button id="p8">Chen</button>
    <button id="color">Color: Rainbow</button>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let width, height;
    let x = 0.1, y = 0, z = 0;
    let hue = 0;
    let colorMode = 'rainbow';
    let attractor = 'lorenz';
    let rotation = { x: 0, y: 0 };
    let dragging = false;
    let lastMouse = { x: 0, y: 0 };
    let points = [];
    const MAX_POINTS = 15000;
    
    const attractors = {
      lorenz: {
        name: 'Lorenz',
        scale: 15,
        dx: (x, y, z) => 10 * (y - x),
        dy: (x, y, z) => x * (28 - z) - y,
        dz: (x, y, z) => x * y - 8/3 * z,
        dt: 0.005
      },
      rossler: {
        name: 'Rössler',
        scale: 20,
        dx: (x, y, z) => -y - z,
        dy: (x, y, z) => x + 0.2 * y,
        dz: (x, y, z) => 0.2 + z * (x - 5),
        dt: 0.02
      },
      thomas: {
        name: 'Thomas',
        scale: 20,
        dx: (x, y, z) => Math.sin(y) - 0.2 * x,
        dy: (x, y, z) => Math.sin(z) - 0.2 * y,
        dz: (x, y, z) => Math.sin(x) - 0.2 * z,
        dt: 0.1
      },
      halvorsen: {
        name: 'Halvorsen',
        scale: 15,
        dx: (x, y, z) => -1.4 * x - 4 * y - 4 * z - y * y,
        dy: (x, y, z) => -1.4 * y - 4 * z - 4 * x - z * z,
        dz: (x, y, z) => -1.4 * z - 4 * x - 4 * y - x * x,
        dt: 0.004
      },
      aizawa: {
        name: 'Aizawa',
        scale: 60,
        dx: (x, y, z) => (z - 0.7) * x - 3.5 * y,
        dy: (x, y, z) => 3.5 * x + (z - 0.7) * y,
        dz: (x, y, z) => 0.6 + 0.95 * z - z * z * z / 3 - (x * x + y * y) * (1 + 0.25 * z) + 0.1 * z * x * x * x,
        dt: 0.01
      },
      dadras: {
        name: 'Dadras',
        scale: 20,
        dx: (x, y, z) => y - a * x + b * y * z,
        dy: (x, y, z) => c * y - x * z + z,
        dz: (x, y, z) => d * x * y - e * z,
        dt: 0.003,
        params: { a: 3, b: 2.7, c: 1.7, d: 2, e: 9 }
      },
      threescroll: {
        name: 'Three-Scroll',
        scale: 15,
        dx: (x, y, z) => a * (y - x),
        dy: (x, y, z) => (c - a) * x - x * z + c * y,
        dz: (x, y, z) => x * y - b * z,
        dt: 0.005,
        params: { a: 40, b: 3, c: 28 }
      },
      chen: {
        name: 'Chen',
        scale: 15,
        dx: (x, y, z) => a * (y - x),
        dy: (x, y, z) => (c - a) * x - x * z + c * y,
        dz: (x, y, z) => x * y - b * z,
        dt: 0.003,
        params: { a: 40, b: 3, c: 28 }
      }
    };
    
    let a = attractors.lorenz.params || {};
    
    function resize() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    }
    
    function project(x, y, z) {
      // Rotate around Y axis
      const cosY = Math.cos(rotation.y);
      const sinY = Math.sin(rotation.y);
      let x1 = x * cosY - z * sinY;
      let z1 = x * sinY + z * cosY;
      
      // Rotate around X axis
      const cosX = Math.cos(rotation.x);
      const sinX = Math.sin(rotation.x);
      let y1 = y * cosX - z1 * sinX;
      let z2 = y * sinX + z1 * cosX;
      
      // Perspective
      const fov = 400;
      const scale = fov / (fov + z2 + 100);
      
      return {
        x: width / 2 + x1 * scale,
        y: height / 2 + y1 * scale,
        z: z2
      };
    }
    
    function update() {
      const att = attractors[attractor];
      
      for (let i = 0; i < 3; i++) {
        const params = { ...att.params, ...a };
        
        // Custom param access for Dadras, Three-Scroll, Chen
        let dx, dy, dz;
        if (attractor === 'dadras') {
          dx = att.dx(x, y, z, params.a, params.b, params.c, params.d, params.e);
          dy = att.dy(x, y, z, params.a, params.b, params.c, params.d, params.e);
          dz = att.dz(x, y, z, params.a, params.b, params.c, params.d, params.e);
        } else if (attractor === 'threescroll' || attractor === 'chen') {
          dx = att.dx(x, y, z, params.a, params.b, params.c);
          dy = att.dy(x, y, z, params.a, params.b, params.c);
          dz = att.dz(x, y, z, params.a, params.b, params.c);
        } else {
          dx = att.dx(x, y, z);
          dy = att.dy(x, y, z);
          dz = att.dz(x, y, z);
        }
        
        x += dx * att.dt;
        y += dy * att.dt;
        z += dz * att.dt;
      }
      
      const proj = project(x * att.scale, y * att.scale, z * att.scale);
      
      points.push(proj);
      if (points.length > MAX_POINTS) points.shift();
      
      hue = (hue + 0.5) % 360;
    }
    
    function draw() {
      ctx.fillStyle = 'rgba(5, 5, 8, 0.08)';
      ctx.fillRect(0, 0, width, height);
      
      // Sort by z for depth
      points.sort((a, b) => b.z - a.z);
      
      for (let i = 1; i < points.length; i++) {
        const p1 = points[i - 1];
        const p2 = points[i];
        
        let color;
        if (colorMode === 'rainbow') {
          color = `hsla(${(hue + i * 0.2) % 360}, 80%, 60%, ${0.3 + i/points.length * 0.7})`;
        } else if (colorMode === 'fire') {
          const t = i / points.length;
          color = `rgb(${255 * t}, ${100 * t}, ${50 * (1-t)})`;
        } else if (colorMode === 'ice') {
          const t = i / points.length;
          color = `rgb(${50 + 100 * (1-t)}, ${150 + 100 * (1-t)}, ${255 * t})`;
        } else {
          color = `rgba(255, 255, 255, ${0.3 + i/points.length * 0.7})`;
        }
        
        ctx.strokeStyle = color;
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p2.x, p2.y);
        ctx.stroke();
      }
    }
    
    function animate() {
      update();
      draw();
      requestAnimationFrame(animate);
    }
    
    function reset() {
      x = 0.1 + (Math.random() - 0.5);
      y = 0 + (Math.random() - 0.5);
      z = 0 + (Math.random() - 0.5);
      points = [];
      hue = Math.random() * 360;
    }
    
    // Events
    canvas.addEventListener('mousedown', (e) => {
      dragging = true;
      lastMouse = { x: e.clientX, y: e.clientY };
    });
    
    canvas.addEventListener('mousemove', (e) => {
      if (dragging) {
        rotation.y += (e.clientX - lastMouse.x) * 0.01;
        rotation.x += (e.clientY - lastMouse.y) * 0.01;
        lastMouse = { x: e.clientX, y: e.clientY };
      }
    });
    
    canvas.addEventListener('mouseup', () => dragging = false);
    canvas.addEventListener('mouseleave', () => dragging = false);
    
    canvas.addEventListener('click', (e) => {
      if (!dragging) reset();
    });
    
    // Presets
    const presets = ['p1','p2','p3','p4','p5','p6','p7','p8'];
    presets.forEach(id => {
      document.getElementById(id).onclick = () => {
        attractor = id.replace('p', '');
        document.getElementById('title').innerText = attractors[attractor].name;
        reset();
      };
    });
    
    const colors = ['rainbow', 'fire', 'ice', 'mono'];
    let colorIdx = 0;
    document.getElementById('color').onclick = () => {
      colorIdx = (colorIdx + 1) % colors.length;
      colorMode = colors[colorIdx];
      document.getElementById('color').innerText = 'Color: ' + colors[colorIdx].charAt(0).toUpperCase() + colors[colorIdx].slice(1);
    };
    
    window.addEventListener('resize', resize);
    resize();
    animate();
  </script>
</body>
</html>
