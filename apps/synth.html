<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Browser Synth â€” Shadow's Garden</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { 
    background: #0a0a0a; 
    color: #888; 
    font-family: 'JetBrains Mono', 'SF Mono', monospace;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  h1 {
    color: #ccc;
    font-weight: 400;
    font-size: 1.2rem;
    margin-bottom: 8px;
  }
  .hint {
    font-size: 0.7rem;
    color: #333;
    margin-bottom: 32px;
  }
  .keys {
    display: flex;
    gap: 8px;
    margin-bottom: 24px;
  }
  .key {
    width: 48px;
    height: 64px;
    background: #151515;
    border: 1px solid #222;
    border-radius: 6px;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 8px;
    color: #444;
    font-size: 0.7rem;
    cursor: pointer;
    transition: all 0.05s;
    user-select: none;
  }
  .key:hover { border-color: #333; }
  .key:active, .key.playing {
    background: #1a1a1a;
    border-color: #4a9;
    color: #4a9;
    transform: translateY(2px);
  }
  .controls {
    display: flex;
    gap: 24px;
    font-size: 0.7rem;
    color: #444;
  }
  .control {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .control label { color: #333; }
  input[type="range"] {
    accent-color: #4a9;
    width: 80px;
  }
</style>
<link rel="stylesheet" href="../style.css">
<script src="../nav.js" defer></script>
<meta name="description" content="A browser synthesizer with oscillator types, detune, and attack/release envelope. Press A-L on your keyboard or click the on-screen keys to play.">
</head>
<body data-page-type="app">
<h1>Browser Synth</h1>
<div class="hint">Click keys or press A-L to play</div>
<div class="keys">
  <div class="key" data-note="C4">A</div>
  <div class="key" data-note="D4">S</div>
  <div class="key" data-note="E4">D</div>
  <div class="key" data-note="F4">F</div>
  <div class="key" data-note="G4">G</div>
  <div class="key" data-note="A4">H</div>
  <div class="key" data-note="B4">J</div>
  <div class="key" data-note="C5">K</div>
  <div class="key" data-note="D5">L</div>
</div>
<div class="controls">
  <div class="control">
    <label>Wave</label>
    <select id="wave">
      <option value="sine">sine</option>
      <option value="square">square</option>
      <option value="sawtooth">saw</option>
      <option value="triangle">tri</option>
    </select>
  </div>
  <div class="control">
    <label>Attack</label>
    <input type="range" id="attack" min="1" max="200" value="50">
  </div>
  <div class="control">
    <label>Release</label>
    <input type="range" id="release" min="50" max="1000" value="200">
  </div>
  <div class="control">
    <label>Detune</label>
    <input type="range" id="detune" min="-50" max="50" value="0">
  </div>
</div>

<script>
const ctx = new (window.AudioContext || window.webkitAudioContext)();
const notes = {
  'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23,
  'G4': 392.00, 'A4': 440.00, 'B4': 493.88, 'C5': 523.25, 'D5': 587.33
};

const keys = document.querySelectorAll('.key');
const waveSelect = document.getElementById('wave');
const attackSlider = document.getElementById('attack');
const releaseSlider = document.getElementById('release');
const detuneSlider = document.getElementById('detune');

const activeOscs = new Map();

function playNote(freq) {
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  
  osc.type = waveSelect.value;
  osc.frequency.value = freq;
  osc.detune.value = parseInt(detuneSlider.value);
  
  const attack = parseInt(attackSlider.value) / 1000;
  const release = parseInt(releaseSlider.value) / 1000;
  
  gain.gain.setValueAtTime(0, ctx.currentTime);
  gain.gain.linearRampToValueAtTime(0.3, ctx.currentTime + attack);
  gain.gain.linearRampToValueAtTime(0, ctx.currentTime + attack + release);
  
  osc.connect(gain);
  gain.connect(ctx.destination);
  
  osc.start();
  osc.stop(ctx.currentTime + attack + release + 0.1);
}

function handleKey(keyEl, pressed) {
  const note = keyEl.dataset.note;
  if (pressed) {
    keyEl.classList.add('playing');
    playNote(notes[note]);
  } else {
    keyEl.classList.remove('playing');
  }
}

keys.forEach(key => {
  key.addEventListener('mousedown', () => handleKey(key, true));
  key.addEventListener('mouseup', () => handleKey(key, false));
  key.addEventListener('mouseleave', () => handleKey(key, false));
});

document.addEventListener('keydown', (e) => {
  const key = e.key.toLowerCase();
  const keyMap = { a: 0, s: 1, d: 2, f: 3, g: 4, h: 5, j: 6, k: 7, l: 8 };
  if (keyMap[key] !== undefined && !e.repeat) {
    handleKey(keys[keyMap[key]], true);
  }
});

document.addEventListener('keyup', (e) => {
  const key = e.key.toLowerCase();
  const keyMap = { a: 0, s: 1, d: 2, f: 3, g: 4, h: 5, j: 6, k: 7, l: 8 };
  if (keyMap[key] !== undefined) {
    handleKey(keys[keyMap[key]], false);
  }
});
</script>
</body>
</html>
