<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Langton's Ant — Shadow's Garden</title>
<meta name="description" content="A simple cellular automaton that creates a 104-step highway after 10,000 steps of chaos.">
<link rel="stylesheet" href="../style.css">
<script src="../nav.js" defer></script>
<style>
  body { margin: 0; overflow: hidden; background: #0a0a0f; }
  canvas { display: block; }
  .controls {
    position: fixed;
    bottom: 20px;
    left: 20px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    z-index: 10;
  }
  button {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    color: #fff;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-family: inherit;
    font-size: 13px;
  }
  button:hover { background: rgba(255,255,255,0.2); }
  .info {
    position: fixed;
    top: 20px;
    left: 20px;
    color: rgba(255,255,255,0.4);
    font-size: 13px;
    font-family: monospace;
  }
  .stats {
    position: fixed;
    top: 20px;
    right: 20px;
    color: rgba(255,255,255,0.5);
    font-size: 13px;
    font-family: monospace;
    text-align: right;
  }
</style>
</head>
<body data-page-type="app">
  <canvas id="canvas"></canvas>
  <div class="info">Space: pause • R: reset • Click to add more ants</div>
  <div class="stats" id="stats">Steps: 0</div>
  <div class="controls">
    <button id="step">Step</button>
    <button id="run">Auto Run</button>
    <button id="reset">Reset</button>
    <button id="fast">Turbo</button>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let width, height;
    let cellSize = 4;
    let cols, rows;
    let grid = {};
    let ants = [];
    let stepCount = 0;
    let running = false;
    let turbo = false;
    let interval = null;
    
    const DIR = [
      [0, -1],  // 0: up
      [1, 0],   // 1: right
      [0, 1],   // 2: down
      [-1, 0]   // 3: left
    ];
    
    function resize() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
      cols = Math.ceil(width / cellSize);
      rows = Math.ceil(height / cellSize);
    }
    
    function reset() {
      grid = {};
      ants = [{ x: Math.floor(cols/2), y: Math.floor(rows/2), dir: 0 }];
      stepCount = 0;
      draw();
      updateStats();
    }
    
    function addAnt() {
      ants.push({
        x: Math.floor(Math.random() * cols),
        y: Math.floor(Math.random() * rows),
        dir: Math.floor(Math.random() * 4)
      });
    }
    
    function step() {
      ants.forEach(ant => {
        const key = `${ant.x},${ant.y}`;
        const white = grid[key];
        
        // Turn based on color
        if (white) {
          ant.dir = (ant.dir + 1) % 4;
          grid[key] = false;
        } else {
          ant.dir = (ant.dir + 3) % 4;
          grid[key] = true;
        }
        
        // Move forward
        ant.x += DIR[ant.dir][0];
        ant.y += DIR[ant.dir][1];
        
        // Wrap around
        if (ant.x < 0) ant.x = cols - 1;
        if (ant.x >= cols) ant.x = 0;
        if (ant.y < 0) ant.y = rows - 1;
        if (ant.y >= rows) ant.y = 0;
      });
      
      stepCount++;
    }
    
    function draw() {
      ctx.fillStyle = '#0a0a0f';
      ctx.fillRect(0, 0, width, height);
      
      // Draw cells
      for (const key in grid) {
        if (grid[key]) {
          const [x, y] = key.split(',').map(Number);
          ctx.fillStyle = '#ff6b6b';
          ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
        }
      }
      
      // Draw ants
      ctx.fillStyle = '#4ecdc4';
      ants.forEach(ant => {
        ctx.beginPath();
        ctx.arc(ant.x * cellSize + cellSize/2, ant.y * cellSize + cellSize/2, cellSize/2, 0, Math.PI * 2);
        ctx.fill();
      });
    }
    
    function updateStats() {
      document.getElementById('stats').innerText = `Steps: ${stepCount.toLocaleString()} | Ants: ${ants.length}`;
    }
    
    function run() {
      if (running) {
        running = false;
        clearInterval(interval);
        document.getElementById('run').innerText = 'Auto Run';
      } else {
        running = true;
        interval = setInterval(() => {
          if (turbo) {
            for (let i = 0; i < 100; i++) {
              step();
            }
          } else {
            step();
          }
          draw();
          updateStats();
        }, turbo ? 0 : 50);
        document.getElementById('run').innerText = 'Stop';
      }
    }
    
    canvas.addEventListener('click', addAnt);
    
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') { run(); e.preventDefault(); }
      if (e.code === 'KeyR') { reset(); }
    });
    
    document.getElementById('step').onclick = () => { step(); draw(); updateStats(); };
    document.getElementById('run').onclick = run;
    document.getElementById('reset').onclick = reset;
    document.getElementById('fast').onclick = () => { turbo = !turbo; };
    
    window.addEventListener('resize', resize);
    resize();
    reset();
  </script>
</body>
</html>
